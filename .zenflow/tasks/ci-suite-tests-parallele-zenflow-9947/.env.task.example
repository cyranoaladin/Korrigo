# Zenflow Task-Specific Environment Variables
# This file should be auto-generated or copied per task to ensure port isolation

# Task ID (should be unique per Zenflow task)
ZENFLOW_TASK_ID=${ZENFLOW_TASK_ID:-default-task-0000}

# Port Allocation Algorithm:
# Extract numeric suffix from task ID (last 4 digits)
# ZENFLOW_PORT_BASE = (task_id_suffix % 9000) + 1000
# This ensures ports are in range 1000-9999
#
# Example: task ID "ci-suite-tests-parallele-zenflow-9947"
#   -> suffix = 9947
#   -> base = (9947 % 9000) + 1000 = 947 + 1000 = 1947
#
# Port assignments:
#   POSTGRES_PORT = 10000 + (base % 1000) = 10947
#   REDIS_PORT    = 16000 + (base % 1000) = 16947  
#   BACKEND_PORT  = 18000 + (base % 1000) = 18947
#   FRONTEND_PORT = 15000 + (base % 1000) = 15947

# Default base port (override per task)
ZENFLOW_PORT_BASE=${ZENFLOW_PORT_BASE:-1000}

# Service Ports (computed from base)
# These should be set to unique values per task
POSTGRES_PORT=${POSTGRES_PORT:-10000}
REDIS_PORT=${REDIS_PORT:-16000}
BACKEND_PORT=${BACKEND_PORT:-18000}
FRONTEND_PORT=${FRONTEND_PORT:-15000}

# Database Configuration
DB_NAME=viatique_task_${ZENFLOW_TASK_ID}
DB_USER=viatique_user
DB_PASSWORD=viatique_password
DB_HOST=127.0.0.1
DB_PORT=${POSTGRES_PORT}

# Backend URLs
BACKEND_URL=http://localhost:${BACKEND_PORT}
DATABASE_URL=postgres://${DB_USER}:${DB_PASSWORD}@db:5432/${DB_NAME}

# Frontend URLs
VITE_API_URL=${BACKEND_URL}/api

# Celery Configuration
CELERY_BROKER_URL=redis://redis:6379/0

# Test-specific settings
PYTEST_WORKERS=${PYTEST_WORKERS:-auto}
DJANGO_SETTINGS_MODULE=core.settings_test
