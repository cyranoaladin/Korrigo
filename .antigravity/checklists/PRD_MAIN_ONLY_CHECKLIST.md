|   PRD# | Domaine                 | Objectif exact (résultat attendu)          | Commandes obligatoires (copier-coller)                                                                                                    | Preuves à coller (logs / outputs)       | Commit sur main (message + hash)                                                                                                | Push sur main (preuve)                           | Gate de sortie (doit être vert)              |                |
| -----: | ----------------------- | ------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------ | -------------------------------------------- | -------------- |
| PRD-01 | Pré-flight              | Repo propre + HEAD connu                   | `git status --porcelain`<br>`git pull --ff-only`<br>`git rev-parse --short HEAD`                                                          | Sortie des 3 commandes                  | `git commit -m "prod: preflight snapshot (PRD-01)"` + **hash** (si aucun changement : **commit vide autorisé** `--allow-empty`) | Sortie `git push origin main`                    | `git status --porcelain` vide + HEAD reporté |                |
| PRD-02 | Compose PROD            | `docker compose ... config` OK (prod)      | `docker compose -f infra/docker/docker-compose.prod.yml config`                                                                           | Sortie commande (OK)                    | `prod: validate compose prod config (PRD-02)` + hash                                                                            | Push OK                                          | Zéro erreur/warn bloquant                    |                |
| PRD-03 | Compose local-prod-like | `config` OK (local-prod)                   | `docker compose -f infra/docker/docker-compose.local-prod.yml config`                                                                     | Sortie (OK)                             | `prod: validate local-prod compose config (PRD-03)` + hash                                                                      | Push OK                                          | Zéro erreur                                  |                |
| PRD-04 | Build images            | Build sans cache OK                        | `docker compose -f infra/docker/docker-compose.local-prod.yml build --no-cache`                                                           | Extrait fin de build (OK)               | `prod: ensure docker images build clean (PRD-04)` + hash                                                                        | Push OK                                          | Build 100% OK                                |                |
| PRD-05 | Boot stack              | Stack up + services UP                     | `docker compose -f infra/docker/docker-compose.local-prod.yml up -d`<br>`docker compose -f infra/docker/docker-compose.local-prod.yml ps` | `ps` complet (UP/healthy)               | `prod: boot local-prod stack (PRD-05)` + hash                                                                                   | Push OK                                          | Tous services UP                             |                |
| PRD-06 | Migrations              | Migrations appliquées sans erreur          | `docker compose -f infra/docker/docker-compose.local-prod.yml exec backend python manage.py migrate`                                      | Sortie migration                        | `prod: apply migrations in local-prod (PRD-06)` + hash                                                                          | Push OK                                          | 0 erreur migration                           |                |
| PRD-07 | Static/Media            | Collectstatic OK + nginx sert statics      | `docker compose -f ... exec backend python manage.py collectstatic --noinput`<br>`docker compose -f ... exec nginx nginx -t`              | Sorties (OK)                            | `prod: validate collectstatic + nginx config (PRD-07)` + hash                                                                   | Push OK                                          | `nginx -t` OK + statics accessibles          |                |
| PRD-08 | Seed                    | Seed déterministe + idempotent             | Commande seed du projet (ex : `python manage.py seed ...` / script)<br>Relancer 2×                                                        | Sortie seed run1 + run2                 | `prod: deterministic idempotent seeding (PRD-08)` + hash                                                                        | Push OK                                          | 2ème seed sans casser                        |                |
| PRD-09 | Backend unit tests      | **Suite complète** backend verte           | `docker compose -f ... exec backend pytest -q`                                                                                            | Résumé pytest (100% pass)               | `prod: green backend test suite (PRD-09)` + hash                                                                                | Push OK                                          | 0 fail / 0 skip suspect                      |                |
| PRD-10 | Front build             | Front build prod OK                        | `docker compose -f ... exec frontend npm ci`<br>`docker compose -f ... exec frontend npm run build`                                       | Résumé build                            | `prod: green frontend build (PRD-10)` + hash                                                                                    | Push OK                                          | build OK                                     |                |
| PRD-11 | Lint/typecheck          | Lint + typecheck OK (si scripts existent)  | `docker compose -f ... exec frontend npm run lint`<br>`docker compose -f ... exec frontend npm run typecheck`                             | Résumés                                 | `prod: green frontend lint/typecheck (PRD-11)` + hash                                                                           | Push OK                                          | 0 error                                      |                |
| PRD-12 | E2E                     | E2E **100% vert** sur stack prod-like      | `bash tools/e2e.sh` (ou commande Playwright du repo)                                                                                      | Résumé e2e + artefacts si fail          | `prod: green e2e suite on local-prod (PRD-12)` + hash                                                                           | Push OK                                          | 0 fail                                       |                |
| PRD-13 | Auth/Lockout            | Vérif lockout TTL réel (manuel + logs)     | Scénario : N tentatives login ratées → lockout → expiration TTL                                                                           | Captures/logs + timestamp               | `prod: validate lockout ttl behavior (PRD-13)` + hash                                                                           | Push OK                                          | TTL conforme LOCKOUT_DURATION                |                |
| PRD-14 | Workflow métier         | Workflow complet réel OK (manuels)         | Import/creation exam → upload copies → assign → lock → annotate → finalize                                                                | Captures + logs endpoints               | `prod: validate full grading workflow (PRD-14)` + hash                                                                          | Push OK                                          | Aucun comportement incohérent                |                |
| PRD-15 | Robustesse restart      | `down/up` sans perte & reprise OK          | `docker compose -f ... down`<br>`docker compose -f ... up -d`<br>`docker compose -f ... ps`                                               | ps + logs boot                          | `prod: validate restart resilience (PRD-15)` + hash                                                                             | Push OK                                          | reprise OK                                   |                |
| PRD-16 | Security headers/nginx  | Nginx hardening minimal vérifié            | `docker compose -f ... exec nginx nginx -T                                                                                                | sed -n '1,200p'`                        | Extrait conf (headers, body size, timeouts)                                                                                     | `prod: nginx hardening baseline (PRD-16)` + hash | Push OK                                      | headers min OK |
| PRD-17 | Observabilité           | Logs exploitables + pas de PII brute       | Vérif logs backend/nginx sur actions sensibles                                                                                            | Exemples de logs (non sensibles)        | `prod: logging sanity + no pii in logs (PRD-17)` + hash                                                                         | Push OK                                          | pas de fuite PII                             |                |
| PRD-18 | Runbook                 | Runbook de prod complet et exact           | Éditer `PROD_RUNBOOK.md` + commandes déploiement korrigo.labomaths.tn                                                                     | Extrait runbook + checklist post-deploy | `docs: finalize prod runbook (PRD-18)` + hash                                                                                   | Push OK                                          | runbook utilisable                           |                |
| PRD-19 | Gate final              | “Go/No-Go” : tout vert + preuve consolidée | `bash tools/verify_prod_ready.sh` + recap                                                                                                 | Sortie script + liens CI verts          | `prod: final go/no-go attestation (PRD-19)` + hash                                                                              | Push OK                                          | script + CI 100% vert                        |                |

