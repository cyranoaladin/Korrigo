â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                              â•‘
â•‘                      ğŸ”´ AUDIT KORRIGO - SYNTHÃˆSE                            â•‘
â•‘                                                                              â•‘
â•‘  Date: 2026-02-05                                                           â•‘
â•‘  Projet: Korrigo (korrigo.labomaths.tn)                                    â•‘
â•‘  Auditeur: Claude Code (Anthropic)                                         â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ ğŸ“Š PROBLÃˆMES IDENTIFIÃ‰S ET RÃ‰SOLUS                                         â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… PROBLÃˆME 1 : Authentification 403 Forbidden (CRITIQUE)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  âŒ SymptÃ´me:
     Login fonctionne â†’ Rechargement (F5) â†’ /api/me/ retourne 403

  ğŸ” Cause Racine:
     backend/core/settings.py ligne 58-59:
       SESSION_COOKIE_SAMESITE lu depuis .env
     MAIS ligne 107-122:
       Valeur JAMAIS rÃ©appliquÃ©e en production
     â†’ Cookies crÃ©Ã©s avec SameSite=Lax au lieu de SameSite=None
     â†’ Navigateur refuse d'envoyer les cookies aprÃ¨s rechargement

  âœ… Correction AppliquÃ©e:
     âœ“ ModifiÃ© backend/core/settings.py ligne 119
       â†’ RÃ©assignation SESSION_COOKIE_SAMESITE en production
     âœ“ CrÃ©Ã© .env.labomaths avec SESSION_COOKIE_SAMESITE=None

  ğŸ“‹ Action Requise:
     1. Copier .env.labomaths vers .env
     2. Ã‰diter .env: SECRET_KEY, DB_PASSWORD
     3. RedÃ©ployer: bash scripts/deploy_fixes.sh


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… PROBLÃˆME 2 : Upload 413 Request Entity Too Large (IMPORTANT)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  âŒ SymptÃ´me:
     Upload PDF > 100 MB â†’ 413 Request Entity Too Large

  ğŸ” Cause Racine:
     1. Django: FILE_UPLOAD_MAX_MEMORY_SIZE = 100 MB
     2. Nginx externe: client_max_body_size potentiellement < 1GB

  âœ… Correction AppliquÃ©e:
     âœ“ ModifiÃ© backend/core/settings.py ligne 74
       â†’ FILE_UPLOAD_MAX_MEMORY_SIZE = 1 GB

  ğŸ“‹ Action Requise:
     1. Configurer Nginx externe:
        sudo nano /etc/nginx/sites-available/labomaths_ecosystem
        Ajouter: client_max_body_size 1G;
     2. Recharger: sudo systemctl reload nginx


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… PROBLÃˆME 3 : OCR et CSV (ANALYSE)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ğŸ” Analyse:
     âœ“ Code OCR correct (Tesseract, matching par full_name)
     âœ“ Code CSV correct (multi-dÃ©limiteurs, validation, BOM UTF-8)
     âœ“ Aucune correction nÃ©cessaire

  ğŸ“‹ Si problÃ¨me OCR/CSV:
     â†’ VÃ©rifier Tesseract installÃ© dans container backend
     â†’ VÃ©rifier format CSV (colonnes: Ã‰lÃ¨ves, NÃ©(e) le, Email)
     â†’ Voir AUDIT_FINAL.md section "ProblÃ¨me 3"


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ ğŸš€ DÃ‰PLOIEMENT RAPIDE (3 COMMANDES)                                        â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

  cd /home/alaeddine/viatique__PMF

  # 1. VÃ©rifier la configuration
  bash scripts/check_config.sh

  # 2. DÃ©ployer les correctifs
  bash scripts/deploy_fixes.sh

  # 3. Tester
  bash scripts/diag_403.sh


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ âš ï¸  ACTIONS MANUELLES REQUISES                                             â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

  1. Configuration .env
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     nano .env

     Remplacer:
       SECRET_KEY=CHANGE_THIS_TO_RANDOM_50_CHAR_STRING
       DB_PASSWORD=CHANGE_THIS_TO_STRONG_PASSWORD

     GÃ©nÃ©rer SECRET_KEY:
       python3 -c "import secrets; print(secrets.token_urlsafe(50))"


  2. Configuration Nginx Externe
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     sudo nano /etc/nginx/sites-available/labomaths_ecosystem

     Ajouter dans le bloc server { ... } pour korrigo.labomaths.tn:

       client_max_body_size 1G;
       proxy_connect_timeout 3600s;
       proxy_send_timeout 3600s;
       proxy_read_timeout 3600s;
       proxy_set_header X-Forwarded-Proto https;

     Recharger:
       sudo nginx -t
       sudo systemctl reload nginx

     Fichier de rÃ©fÃ©rence: scripts/nginx_korrigo_config.conf


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ ğŸ“‚ FICHIERS CRÃ‰Ã‰S PAR L'AUDIT                                              â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

  Documentation:
    âœ“ AUDIT_FINAL.md                  Rapport d'audit complet
    âœ“ CORRECTIFS_403.md               Guide de correction dÃ©taillÃ©
    âœ“ README_CORRECTIFS.md            Guide rapide (START HERE!)
    âœ“ SYNTHESE_AUDIT.txt              Ce document

  Configuration:
    âœ“ .env.labomaths                  Template configuration production
    âœ“ scripts/nginx_korrigo_config.conf   Configuration Nginx de rÃ©fÃ©rence

  Scripts:
    âœ“ scripts/check_config.sh         VÃ©rification configuration
    âœ“ scripts/deploy_fixes.sh         DÃ©ploiement automatisÃ©
    âœ“ scripts/diag_403.sh             Diagnostic (existant, rendu exÃ©cutable)

  Code ModifiÃ©:
    âœ“ backend/core/settings.py        Lignes 74 (upload) et 119 (cookies)


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ âœ… CHECKLIST DE VALIDATION                                                 â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

  Configuration:
    â–¡ .env crÃ©Ã© depuis .env.labomaths
    â–¡ SECRET_KEY remplacÃ© dans .env
    â–¡ DB_PASSWORD remplacÃ© dans .env
    â–¡ Nginx externe configurÃ© (client_max_body_size 1G)

  DÃ©ploiement:
    â–¡ Backend redÃ©ployÃ© (docker-compose up -d --build)
    â–¡ Nginx externe rechargÃ© (sudo systemctl reload nginx)
    â–¡ bash scripts/check_config.sh â†’ Tous les âœ…

  Tests:
    â–¡ bash scripts/diag_403.sh â†’ âœ… /api/me/ fonctionne
    â–¡ Navigateur: Login â†’ Cookies (SameSite=None, Secure=âœ“)
    â–¡ Navigateur: F5 â†’ /api/me/ retourne 200 OK (pas 403)
    â–¡ Upload PDF > 100 MB â†’ OK (pas d'erreur 413)


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ ğŸ“ SUPPORT ET DOCUMENTATION                                                â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

  DÃ©marrage rapide:           README_CORRECTIFS.md
  Documentation complÃ¨te:     AUDIT_FINAL.md
  Guide de correction:        CORRECTIFS_403.md

  Debug:
    bash scripts/check_config.sh     VÃ©rifier configuration
    bash scripts/diag_403.sh         Diagnostic complet
    docker-compose logs backend      Logs backend
    sudo tail -f /var/log/nginx/error.log    Logs Nginx


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ ğŸ¯ PROCHAINES Ã‰TAPES                                                       â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

  1. Lire README_CORRECTIFS.md pour comprendre les changements

  2. ExÃ©cuter le dÃ©ploiement:
     cd /home/alaeddine/viatique__PMF
     bash scripts/deploy_fixes.sh

  3. Effectuer les actions manuelles (Ã©diter .env, configurer Nginx)

  4. Tester dans le navigateur

  5. Si problÃ¨me, consulter AUDIT_FINAL.md section "DÃ©pannage"


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                              â•‘
â•‘  âœ… AUDIT TERMINÃ‰ - CORRECTIFS APPLIQUÃ‰S                                   â•‘
â•‘                                                                              â•‘
â•‘  Les modifications du code sont COMPLÃˆTES.                                 â•‘
â•‘  Il ne reste que le DÃ‰PLOIEMENT et la CONFIGURATION.                       â•‘
â•‘                                                                              â•‘
â•‘  ğŸ‘‰ Commencer par: bash scripts/deploy_fixes.sh                            â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
