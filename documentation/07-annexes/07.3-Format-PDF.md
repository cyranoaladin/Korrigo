# 07.3 - Format PDF des Examens

**Projet** : Korrigo - Syst√®me de Correction d'Examens
**Version** : 2.0 (PRD-19)
**Date** : 3 F√©vrier 2026
**Auteur** : **Alaeddine BEN RHOUMA**

---

## üéØ Objectif

Ce document sp√©cifie le **format PDF requis** pour les examens scann√©s upload√©s dans Korrigo, incluant dimensions, qualit√©, orientation, et bonnes pratiques.

---

## üìã Formats Support√©s

### 1. Batch A3 (Recommand√©)

**Description** : Copies scann√©es en A3 recto-verso agraf√©es

**Caract√©ristiques** :
- **Format papier** : A3 (297 √ó 420 mm)
- **Scan** : Recto-verso (double-face)
- **Orientation** : Portrait
- **R√©solution** : 300 DPI (recommand√©), minimum 150 DPI
- **Couleur** : Niveaux de gris ou couleur (RGB)
- **Compression** : PDF standard (pas de compression excessive)

**Structure** :

```
PDF Batch A3 (88 pages)
‚îú‚îÄ‚îÄ Page 1 (A3 recto)   ‚Üí Feuille 1 - Faces 1-2 (√©tudiant 1)
‚îú‚îÄ‚îÄ Page 2 (A3 verso)   ‚Üí Feuille 1 - Faces 3-4 (√©tudiant 1)
‚îú‚îÄ‚îÄ Page 3 (A3 recto)   ‚Üí Feuille 2 - Faces 1-2 (√©tudiant 1)
‚îú‚îÄ‚îÄ Page 4 (A3 verso)   ‚Üí Feuille 2 - Faces 3-4 (√©tudiant 1)
‚îú‚îÄ‚îÄ Page 5 (A3 recto)   ‚Üí Feuille 3 - Faces 1-2 (√©tudiant 2)
‚îú‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ Page 88 (A3 verso)  ‚Üí Feuille 44 - Faces 3-4 (√©tudiant 28)
```

**Exemple r√©el** : `eval_loi_binom_log.pdf` (88 pages A3, 28 √©tudiants)

---

### 2. Batch A4 (Support basique)

**Description** : Copies scann√©es en A4 recto simple

**Caract√©ristiques** :
- **Format papier** : A4 (210 √ó 297 mm)
- **Scan** : Recto uniquement (simple-face)
- **Orientation** : Portrait
- **R√©solution** : 300 DPI (recommand√©)

**Structure** :

```
PDF Batch A4 (88 pages)
‚îú‚îÄ‚îÄ Page 1 (A4)   ‚Üí Feuille 1 - Face 1 (√©tudiant 1)
‚îú‚îÄ‚îÄ Page 2 (A4)   ‚Üí Feuille 1 - Face 2 (√©tudiant 1)
‚îú‚îÄ‚îÄ Page 3 (A4)   ‚Üí Feuille 1 - Face 3 (√©tudiant 1)
‚îú‚îÄ‚îÄ Page 4 (A4)   ‚Üí Feuille 1 - Face 4 (√©tudiant 1)
‚îú‚îÄ‚îÄ Page 5 (A4)   ‚Üí Feuille 2 - Face 1 (√©tudiant 2)
‚îú‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ Page 88 (A4)  ‚Üí Feuille 22 - Face 4 (√©tudiant 22)
```

---

## üìê Sp√©cifications Techniques

### Dimensions

| Format | Largeur | Hauteur | Pixels (300 DPI) |
|--------|---------|---------|------------------|
| **A3** | 297 mm | 420 mm | 3508 √ó 4961 px |
| **A4** | 210 mm | 297 mm | 2480 √ó 3508 px |

### R√©solution

| DPI | Qualit√© | Taille Fichier (estim√©e) | Usage |
|-----|---------|--------------------------|-------|
| **150** | Minimale | ~20 MB pour 88 pages | Acceptable, OCR d√©grad√© |
| **300** | Recommand√©e | ~50 MB pour 88 pages | Optimal, OCR pr√©cis |
| **600** | √âlev√©e | ~150 MB pour 88 pages | Inutile, surcharge |

**Recommandation** : **300 DPI** (compromis qualit√©/taille)

### Profondeur Couleur

| Mode | Bits/pixel | Taille Fichier | OCR | Recommandation |
|------|------------|----------------|-----|----------------|
| **Noir & Blanc (1-bit)** | 1 | Tr√®s petit | Moyen | ‚ùå D√©conseill√© |
| **Niveaux de gris (8-bit)** | 8 | Petit | Bon | ‚úÖ **Recommand√©** |
| **Couleur RGB (24-bit)** | 24 | Grand | Tr√®s bon | ‚úÖ Acceptable |

---

## üìÑ Structure PDF

### Header Copie (Zone d'Identification)

**Position** : 5 cm depuis le haut de la premi√®re page de chaque copie

**Contenu** :
- Nom de famille (MAJUSCULES)
- Pr√©nom (Premi√®re lettre majuscule)
- Date de naissance (DD/MM/YYYY)

**Exemple visuel** :

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Nom : DUPONT                           ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ 1 cm depuis haut
‚îÇ  Pr√©nom : Jean                          ‚îÇ
‚îÇ  Date de naissance : 15/05/2008         ‚îÇ
‚îÇ                                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚óÑ‚îÄ‚îÄ‚îÄ 5 cm (limite header)
‚îÇ                                         ‚îÇ
‚îÇ  Question 1 : ...                       ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  Question 2 : ...                       ‚îÇ
‚îÇ                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**D√©tection automatique** :
- Korrigo d√©tecte automatiquement zone header (5 cm haut)
- OCR multi-layer extrait nom + pr√©nom + date
- Fuzzy matching avec CSV √©tudiants

---

## üñ®Ô∏è Bonnes Pratiques Scan

### 1. Param√®tres Scanner

**Scanner recommand√©s** :
- Canon imageFORMULA
- Fujitsu ScanSnap
- HP ScanJet Enterprise

**Param√®tres** :

```
R√©solution : 300 DPI
Mode couleur : Niveaux de gris (8-bit)
Format : PDF/A-1b (archivage)
Compression : JPEG (qualit√© 85%)
Deskew : Activ√© (redressement auto)
Blank page removal : D√©sactiv√© (garder toutes pages)
```

### 2. Pr√©paration Copies Papier

**Avant scan** :

1. **Retirer agrafes** : Scanner d√©tecte mieux les pages individuelles
2. **Aplatir plis** : √âviter ombres OCR
3. **V√©rifier ordre** : Pages dans bon ordre
4. **Nettoyer scanner** : √âviter taches/poussi√®re

### 3. Ordre de Scan

**Batch A3 recto-verso** :

```
Pile de copies (top ‚Üí bottom):
‚îú‚îÄ‚îÄ Copie √âtudiant 1 (2 feuilles A3)
‚îú‚îÄ‚îÄ Copie √âtudiant 2 (2 feuilles A3)
‚îú‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ Copie √âtudiant 28 (2 feuilles A3)

Scanner en mode recto-verso automatique (ADF)
‚Üí G√©n√®re PDF 88 pages (44 feuilles √ó 2 faces)
```

**Important** : Scanner doit √™tre configur√© en **recto-verso automatique (duplex)**

---

## ‚úÖ Validation PDF

### Checklist Avant Upload

```bash
# 1. V√©rifier nombre de pages
pdfinfo exam.pdf | grep Pages

# 2. V√©rifier r√©solution
pdfimages -list exam.pdf | head -5

# 3. V√©rifier taille fichier
ls -lh exam.pdf

# 4. V√©rifier pas de corruption
pdfinfo exam.pdf > /dev/null && echo "PDF valide" || echo "PDF corrompu"
```

### Outils Validation

**PyPDF2 (Python)** :

```python
import PyPDF2

def validate_pdf(pdf_path):
    """Valider PDF avant upload."""
    try:
        with open(pdf_path, 'rb') as f:
            pdf_reader = PyPDF2.PdfReader(f)

            # Nombre de pages
            page_count = len(pdf_reader.pages)
            print(f"Pages: {page_count}")

            # Taille pages (premi√®re page)
            page = pdf_reader.pages[0]
            width = page.mediabox.width
            height = page.mediabox.height
            print(f"Dimensions: {width} √ó {height} points")

            # V√©rifier m√©tadonn√©es
            metadata = pdf_reader.metadata
            if metadata:
                print(f"Producer: {metadata.get('/Producer', 'Unknown')}")

            return True

    except Exception as e:
        print(f"Erreur validation: {e}")
        return False

# Usage
validate_pdf('eval_loi_binom_log.pdf')
```

**Output attendu** :
```
Pages: 88
Dimensions: 841.8897637795276 √ó 1190.5511811023622 points (A4)
Producer: Scanner Software v2.0
```

---

## üîß Correction PDF Probl√©matiques

### Probl√®me 1 : Pages D√©salign√©es (Skew)

**Sympt√¥me** : Pages scann√©es de travers

**Solution** :

```python
import cv2
import numpy as np
from pdf2image import convert_from_path

def deskew_pdf(pdf_path, output_path):
    """Corriger rotation pages PDF."""
    images = convert_from_path(pdf_path, dpi=300)

    deskewed_images = []
    for img in images:
        # Convertir PIL ‚Üí OpenCV
        img_cv = cv2.cvtColor(np.array(img), cv2.COLOR_RGB2GRAY)

        # D√©tecter angle
        coords = np.column_stack(np.where(img_cv > 0))
        angle = cv2.minAreaRect(coords)[-1]

        if angle < -45:
            angle = -(90 + angle)
        else:
            angle = -angle

        # Rotation
        (h, w) = img_cv.shape[:2]
        center = (w // 2, h // 2)
        M = cv2.getRotationMatrix2D(center, angle, 1.0)
        rotated = cv2.warpAffine(img_cv, M, (w, h), flags=cv2.INTER_CUBIC)

        deskewed_images.append(rotated)

    # Sauvegarder PDF corrig√©
    # ... (conversion images ‚Üí PDF)
```

### Probl√®me 2 : PDF Trop Volumineux

**Sympt√¥me** : Fichier > 100 MB (limite upload)

**Solution : Compression** :

```bash
# Ghostscript compression
gs -sDEVICE=pdfwrite \
   -dCompatibilityLevel=1.4 \
   -dPDFSETTINGS=/ebook \
   -dNOPAUSE -dQUIET -dBATCH \
   -sOutputFile=exam_compressed.pdf \
   exam.pdf

# V√©rifier nouvelle taille
ls -lh exam_compressed.pdf
```

**Niveaux compression** :

| Param√®tre | Qualit√© | Taille | Usage |
|-----------|---------|--------|-------|
| `/screen` | Basse (72 DPI) | Tr√®s petit | ‚ùå D√©conseill√© |
| `/ebook` | Moyenne (150 DPI) | Petit | ‚úÖ Acceptable |
| `/printer` | √âlev√©e (300 DPI) | Moyen | ‚úÖ **Recommand√©** |
| `/prepress` | Maximale (300+ DPI) | Grand | ‚ùå Inutile |

### Probl√®me 3 : Pages Invers√©es

**Sympt√¥me** : Versos √† l'envers

**Solution** :

```python
import PyPDF2

def fix_inverted_pages(pdf_path, output_path):
    """Corriger pages invers√©es (rotation 180¬∞)."""
    pdf_reader = PyPDF2.PdfReader(pdf_path)
    pdf_writer = PyPDF2.PdfWriter()

    for i, page in enumerate(pdf_reader.pages):
        # Pages paires (versos) ‚Üí rotation 180¬∞
        if i % 2 == 1:
            page.rotate(180)

        pdf_writer.add_page(page)

    with open(output_path, 'wb') as f:
        pdf_writer.write(f)
```

---

## üìä Exemples R√©els

### Exemple 1 : Batch A3 Standard

**Fichier** : `eval_loi_binom_log.pdf`

```
Fichier : eval_loi_binom_log.pdf
Taille : 52.3 MB
Pages : 88 (44 feuilles A3 recto-verso)
Format : A3 (3508 √ó 4961 px @ 300 DPI)
Couleur : Niveaux de gris (8-bit)
Compression : JPEG qualit√© 85%
√âtudiants : 28 (88 pages √∑ 4 pages/√©tudiant √ó 2 feuilles)
```

**Structure** :

```
Page 1-4   : √âtudiant 1 (2 feuilles √ó 2 faces)
Page 5-8   : √âtudiant 2
...
Page 85-88 : √âtudiant 28
```

### Exemple 2 : Batch A4 Simple

**Fichier** : `controle_maths_g3.pdf`

```
Fichier : controle_maths_g3.pdf
Taille : 18.2 MB
Pages : 60 (60 feuilles A4 recto)
Format : A4 (2480 √ó 3508 px @ 300 DPI)
Couleur : Niveaux de gris
√âtudiants : 30 (60 pages √∑ 2 pages/√©tudiant)
```

---

## üõ†Ô∏è G√©n√©ration PDF Test

### Script G√©n√©ration

**Objectif** : G√©n√©rer PDF test pour d√©veloppement

```python
#!/usr/bin/env python3
"""
G√©n√©rer PDF test avec headers √©tudiants.

Usage:
    python generate_test_pdf.py --students 30 --pages 4 --output test_exam.pdf
"""

from reportlab.pdfgen import canvas
from reportlab.lib.pagesizes import A4, A3
from reportlab.lib.units import cm
import random

FIRST_NAMES = ['Jean', 'Marie', 'Luc', 'Sophie', 'Pierre', 'Emma', 'Thomas', 'L√©a']
LAST_NAMES = ['DUPONT', 'MARTIN', 'BERNARD', 'PETIT', 'DURAND', 'LEROY', 'MOREAU', 'SIMON']

def generate_test_pdf(student_count, pages_per_student, output_path, page_format='A3'):
    """G√©n√©rer PDF test avec headers."""

    page_size = A3 if page_format == 'A3' else A4
    c = canvas.Canvas(output_path, pagesize=page_size)

    for student_num in range(1, student_count + 1):
        # G√©n√©rer identit√© √©tudiant
        first_name = random.choice(FIRST_NAMES)
        last_name = random.choice(LAST_NAMES)

        # Date naissance (15-18 ans)
        birth_year = random.randint(2006, 2009)
        birth_month = random.randint(1, 12)
        birth_day = random.randint(1, 28)
        dob = f"{birth_day:02d}/{birth_month:02d}/{birth_year}"

        # Pages de la copie
        for page_num in range(1, pages_per_student + 1):
            # Header (uniquement premi√®re page)
            if page_num == 1:
                c.setFont("Helvetica-Bold", 14)
                c.drawString(2*cm, page_size[1] - 2*cm, f"Nom : {last_name}")
                c.drawString(2*cm, page_size[1] - 3*cm, f"Pr√©nom : {first_name}")
                c.drawString(2*cm, page_size[1] - 4*cm, f"Date de naissance : {dob}")

                # Ligne s√©paration
                c.line(1*cm, page_size[1] - 5*cm, page_size[0] - 1*cm, page_size[1] - 5*cm)

            # Contenu page (questions simul√©es)
            c.setFont("Helvetica", 12)
            y_pos = page_size[1] - 7*cm if page_num == 1 else page_size[1] - 2*cm

            c.drawString(2*cm, y_pos, f"Copie {student_num} - Page {page_num}")

            # Questions simul√©es
            for q in range(1, 4):
                y_pos -= 2*cm
                c.drawString(2*cm, y_pos, f"Question {q}: R√©ponse √©tudiant...")

            # Nouvelle page
            c.showPage()

    c.save()
    print(f"‚úÖ PDF g√©n√©r√© : {output_path}")
    print(f"   - √âtudiants : {student_count}")
    print(f"   - Pages : {student_count * pages_per_student}")

if __name__ == '__main__':
    import argparse

    parser = argparse.ArgumentParser()
    parser.add_argument('--students', type=int, default=30)
    parser.add_argument('--pages', type=int, default=4)
    parser.add_argument('--format', choices=['A3', 'A4'], default='A3')
    parser.add_argument('--output', default='test_exam.pdf')

    args = parser.parse_args()

    generate_test_pdf(args.students, args.pages, args.output, args.format)
```

**Usage** :

```bash
# G√©n√©rer PDF test 30 √©tudiants, 4 pages chacun (A3)
python generate_test_pdf.py --students 30 --pages 4 --format A3 --output test_batch_a3.pdf

# V√©rifier
pdfinfo test_batch_a3.pdf
```

---

## üìù Conclusion

Le format PDF des examens doit respecter des sp√©cifications strictes (A3 300 DPI, niveaux de gris) pour garantir un OCR optimal. Les outils de validation et correction permettent de pr√©parer des PDF conformes avant upload.

**Points cl√©s** :
- Format A3 recto-verso (recommand√©)
- R√©solution 300 DPI
- Niveaux de gris 8-bit
- Header 5 cm (nom, pr√©nom, date naissance)
- Taille < 100 MB
- Validation avant upload

---

**Document r√©dig√© par :**
**Alaeddine BEN RHOUMA**
*Lead Senior Documentation & Architecture*
Date : 3 F√©vrier 2026
