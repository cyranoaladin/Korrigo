============================= test session starts ==============================
platform linux -- Python 3.9.23, pytest-8.3.3, pluggy-1.6.0 -- /home/alaeddine/micromamba/bin/python3
cachedir: .pytest_cache
django: version: 4.2.27, settings: core.settings (from ini)
rootdir: /home/alaeddine/viatique__PMF/backend
configfile: pytest.ini
plugins: cov-4.1.0, django-4.11.1, mock-3.14.0, anyio-4.11.0
collecting ... collected 50 items

grading/tests/test_anti_loss.py::TestAntiLoss::test_finalize_idempotency_or_safety PASSED [  2%]
grading/tests/test_anti_loss.py::TestAntiLoss::test_lock_idempotency PASSED [  4%]
grading/tests/test_anti_loss.py::TestAntiLoss::test_annotation_create_atomicity PASSED [  6%]
grading/tests/test_anti_loss.py::TestAntiLoss::test_import_transaction_atomicity PASSED [  8%]
grading/tests/test_error_handling.py::test_value_error_returns_400_detail PASSED [ 10%]
grading/tests/test_error_handling.py::test_permission_error_returns_403_detail PASSED [ 12%]
grading/tests/test_error_handling.py::test_unexpected_error_returns_500_generic_detail PASSED [ 14%]
grading/tests/test_error_handling.py::test_all_workflow_endpoints_use_detail_format PASSED [ 16%]
grading/tests/test_error_handling.py::test_missing_required_field_returns_400_detail PASSED [ 18%]
grading/tests/test_error_handling.py::test_unauthenticated_request_returns_403 PASSED [ 20%]
grading/tests/test_error_handling.py::test_non_staff_user_returns_403 PASSED [ 22%]
grading/tests/test_finalize.py::test_finalize_sets_status_graded PASSED  [ 24%]
grading/tests/test_finalize.py::test_finalize_sets_final_pdf_field PASSED [ 26%]
grading/tests/test_finalize.py::test_final_pdf_endpoint_404_when_missing PASSED [ 28%]
grading/tests/test_finalize.py::test_final_pdf_endpoint_200_when_present PASSED [ 30%]
grading/tests/test_finalize.py::test_finalize_computes_score_from_annotations PASSED [ 32%]
grading/tests/test_finalize.py::test_finalize_creates_grading_event PASSED [ 34%]
grading/tests/test_integration_real.py::TestIntegrationReal::test_full_import_flow_real_fs PASSED [ 36%]
grading/tests/test_integration_real.py::TestIntegrationReal::test_security_gates_real PASSED [ 38%]
grading/tests/test_integration_real.py::TestIntegrationReal::test_student_block_real PASSED [ 40%]
grading/tests/test_phase39_hardening.py::test_import_permissions_forbidden_for_non_staff PASSED [ 42%]
grading/tests/test_phase39_hardening.py::test_import_success_for_teacher_creates_copy_booklet_and_audit PASSED [ 44%]
grading/tests/test_phase39_hardening.py::test_audit_endpoint_requires_staff PASSED [ 46%]
grading/tests/test_phase39_hardening.py::test_final_pdf_security_gate PASSED [ 48%]
grading/tests/test_services_strict_unit.py::TestGradingServiceStrictUnit::test_rasterize_pdf_handles_resources_strictly PASSED [ 50%]
grading/tests/test_services_strict_unit.py::TestGradingServiceStrictUnit::test_rasterize_pdf_raises_value_error_on_empty_pdf PASSED [ 52%]
grading/tests/test_services_strict_unit.py::TestGradingServiceStrictUnit::test_import_pdf_rollback_on_raster_failure PASSED [ 54%]
grading/tests/test_services_strict_unit.py::TestGradingServiceStrictUnit::test_validate_copy_invariants PASSED [ 56%]
grading/tests/test_services_strict_unit.py::TestGradingServiceStrictUnit::test_lock_copy_invariants PASSED [ 58%]
grading/tests/test_validation.py::test_reject_annotation_with_w_zero PASSED [ 60%]
grading/tests/test_validation.py::test_reject_annotation_with_overflow_x_plus_w PASSED [ 62%]
grading/tests/test_validation.py::test_reject_annotation_with_overflow_y_plus_h PASSED [ 64%]
grading/tests/test_validation.py::test_reject_annotation_with_negative_values PASSED [ 66%]
grading/tests/test_validation.py::test_reject_page_index_out_of_bounds PASSED [ 68%]
grading/tests/test_validation.py::test_accept_page_index_as_string_int PASSED [ 70%]
grading/tests/test_workflow.py::test_ready_transition_requires_pages PASSED [ 72%]
grading/tests/test_workflow.py::test_ready_transition_changes_status_and_creates_event PASSED [ 74%]
grading/tests/test_workflow.py::test_lock_only_allowed_from_ready PASSED [ 76%]
grading/tests/test_workflow.py::test_finalize_only_allowed_from_locked PASSED [ 78%]
grading/tests/test_workflow.py::test_lock_transition_success PASSED      [ 80%]
grading/tests/test_workflow.py::test_unlock_transition_success PASSED    [ 82%]
grading/tests/test_workflow_complete.py::TestWorkflowComplete::test_workflow_teacher_full_cycle_success PASSED [ 84%]
grading/tests/test_workflow_complete.py::TestWorkflowComplete::test_workflow_import_corrupted_rollback PASSED [ 86%]
grading/tests/test_workflow_complete.py::TestWorkflowComplete::test_workflow_student_access_denied PASSED [ 88%]
grading/tests/test_fixtures_p1.py::test_fixtures_existence PASSED        [ 90%]
grading/tests/test_fixtures_p1.py::test_simple_pdf_properties PASSED     [ 92%]
grading/tests/test_fixtures_p1.py::test_heavy_pdf_properties PASSED      [ 94%]
grading/tests/test_fixtures_p1.py::test_corrupted_pdf_raises_error PASSED [ 96%]
grading/tests/test_serializers_strict.py::TestSerializersStrict::test_booklet_serializer_integrity PASSED [ 98%]
grading/tests/test_serializers_strict.py::TestSerializersStrict::test_copy_serializer_embedding PASSED [100%]

---------- coverage: platform linux, python 3.9.23-final-0 -----------
Name                                                                                                       Stmts   Miss  Cover
------------------------------------------------------------------------------------------------------------------------------
grading/__init__.py                                                                                            0      0   100%
grading/migrations/0001_initial.py                                                                             7      0   100%
grading/migrations/0002_refactor_annotation_and_add_grading_event.py                                           7      0   100%
grading/migrations/0003_rename_grading_ann_copy_id_f6ec3e_idx_grading_ann_copy_id_35b843_idx_and_more.py       4      0   100%
grading/migrations/__init__.py                                                                                 0      0   100%
grading/models.py                                                                                             55      2    96%
grading/serializers.py                                                                                        36     14    61%
grading/services.py                                                                                          183     10    95%
grading/tests/__init__.py                                                                                      0      0   100%
grading/tests/test_anti_loss.py                                                                               57      0   100%
grading/tests/test_error_handling.py                                                                          85      0   100%
grading/tests/test_finalize.py                                                                               110      6    95%
grading/tests/test_fixtures_p1.py                                                                             34      3    91%
grading/tests/test_integration_real.py                                                                        68      0   100%
grading/tests/test_phase39_hardening.py                                                                      108      2    98%
grading/tests/test_serializers_strict.py                                                                      32      0   100%
grading/tests/test_services_strict_unit.py                                                                    80      0   100%
grading/tests/test_validation.py                                                                              64      0   100%
grading/tests/test_workflow.py                                                                               103      0   100%
grading/tests/test_workflow_complete.py                                                                      110      0   100%
grading/urls.py                                                                                                3      0   100%
grading/views.py                                                                                             126     13    90%
------------------------------------------------------------------------------------------------------------------------------
TOTAL                                                                                                       1272     50    96%


============================== 50 passed in 5.27s ==============================
