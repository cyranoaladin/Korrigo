# Server override for korrigo.labomaths.tn
# Usage: docker compose -f docker-compose.yml -f docker-compose.server.yml up -d
# Reads production values from infra/docker/.env (Docker Compose project .env)

services:
  backend:
    environment:
      DATABASE_URL: postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@db:5432/${POSTGRES_DB}
      SECRET_KEY: ${SECRET_KEY}
      DJANGO_ENV: ${DJANGO_ENV:-production}
      DEBUG: ${DEBUG:-False}
      SSL_ENABLED: ${SSL_ENABLED:-True}
      ALLOWED_HOSTS: ${ALLOWED_HOSTS:-korrigo.labomaths.tn,localhost,127.0.0.1}
      CSRF_TRUSTED_ORIGINS: ${CSRF_TRUSTED_ORIGINS:-https://korrigo.labomaths.tn}
      CORS_ALLOWED_ORIGINS: ${CORS_ALLOWED_ORIGINS:-https://korrigo.labomaths.tn}
      REDIS_HOST: ${REDIS_HOST:-redis}
      METRICS_TOKEN: ${METRICS_TOKEN:-}
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      OPENAI_MODEL: ${OPENAI_MODEL:-gpt-4.1-mini-2025-04-14}

  celery:
    environment:
      DATABASE_URL: postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@db:5432/${POSTGRES_DB}
      SECRET_KEY: ${SECRET_KEY}
      DJANGO_ENV: ${DJANGO_ENV:-production}
      DEBUG: ${DEBUG:-False}
      REDIS_HOST: ${REDIS_HOST:-redis}
