# Server override for korrigo.labomaths.tn
# Usage: docker compose -f docker-compose.yml -f docker-compose.server.yml up -d
# Reads production values from ../../.env (or infra/docker/.env)

services:
  backend:
    environment:
      DATABASE_URL: ${DATABASE_URL}
      SECRET_KEY: ${SECRET_KEY}
      DJANGO_ENV: ${DJANGO_ENV:-production}
      DEBUG: ${DEBUG:-False}
      SSL_ENABLED: ${SSL_ENABLED:-True}
      ALLOWED_HOSTS: ${ALLOWED_HOSTS:-korrigo.labomaths.tn,localhost,127.0.0.1}
      CSRF_TRUSTED_ORIGINS: ${CSRF_TRUSTED_ORIGINS:-https://korrigo.labomaths.tn}
      CORS_ALLOWED_ORIGINS: ${CORS_ALLOWED_ORIGINS:-https://korrigo.labomaths.tn}
      REDIS_HOST: ${REDIS_HOST:-redis}
      METRICS_TOKEN: ${METRICS_TOKEN:-}

  celery:
    environment:
      DATABASE_URL: ${DATABASE_URL}
      SECRET_KEY: ${SECRET_KEY}
      DJANGO_ENV: ${DJANGO_ENV:-production}
      DEBUG: ${DEBUG:-False}
      REDIS_HOST: ${REDIS_HOST:-redis}
